<!DOCTYPE html>

<html lang="en-us">

<head>

  <meta charset="UTF-8">
  <title>Train Scheduler</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

  <!-- LINK TO FIREBASE GOES HERE -->
  <script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script>
  <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

</head>

<body>

  <div class="container">

    <br>

    <!-- Jumbotron -->
    <div class="jumbotron bg-info">
      <h1 class="text-center">Train Scheduler</h1>
    </div>

    <div class="row">
        <!-- On rows -->
        <div class="table-responsive">
        <table class="table table-dark" id="train-table">
            <thead>
              <tr>
                <th scope="col">Train Number</th>
                <th scope="col">Train Name</th>
                <th scope="col">Destination</th>
                <th scope="col">Frequency (min)</th>
                <th scope="col">Next Arrival</th>
                <th scope="col">Minutes Away</th>
              </tr>
            </thead>
            <tbody>
              <tr class="bg-primary">
                <th scope="row" id="number">1</th>
                <td id="name">Blue Line</td>
                <td id="destination">O'Hare</td>
                <td id="frequency">5</td>
                <td id="next-arrival"></td>
                <td id="minutes-away"></td>
              </tr>
              <tr>
                <th scope="row" id="number">2</th>
                <td id="name">BNSF</td>
                <td id="destination">Elburn</td>
                <td id="frequency">5</td>
                <td id="next-arrival"></td>
                <td id="minutes-away"></td>
              </tr>
              <tr class="bg-success">
                <th scope="row" id="number">3</th>
                <td id="name">Green Line</td>
                <td id="destination">Oak Park</td>
                <td id="frequency">5</td>
                <td id="next-arrival"></td>
                <td id="minutes-away"></td>
              </tr>
            </tbody>
          </table>
        </div>
      <!-- Add train Card-->
      <div class="col-lg-12">
        <div class="card card-default bg-light">
          <div class="card-header bg-info font-weight-bold">
            Add Train
          </div>
          <div class="card-body">

            <!-- Add train Form (note the various input "types")-->

            <form role="form">
              <div class="form-group row">
                <label for="name-input">Train Name</label>
                <input class="form-control" id="name-input" type="text">
              </div>
              <div class="form-group row">
                <label for="destination-input">Destination</label>
                <input class="form-control" id="destination-input" type="text">
              </div>
              <div class="form-group row">
                <label for="time-input">First Train Time (HH:mm - military time)</label>
                <input class="form-control" id="time-input" type="text" placeholder="00:00">
              </div>
              <div class="form-group row">
                <label for="frequency-input">Frequency</label>
                <input class="form-control" rows="5" id="frequency-input">
              </div>
              <button class="btn btn-default" id="add-train" type="submit">Submit</button>
            </form>

          </div>

        </div>

      </div>

    </div>

  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>

  <!-- Script -->

  <script>
    // ========================================== START CODING BELOW!!

    // Initialize Firebase
      // Initialize Firebase
 


  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAQiCsaZmhVZtCMPN0vZPwbu-eCuHd15Qs",
    authDomain: "train-scheduler-1c2c9.firebaseapp.com",
    databaseURL: "https://train-scheduler-1c2c9.firebaseio.com",
    projectId: "train-scheduler-1c2c9",
    storageBucket: "",
    messagingSenderId: "933474237242"
  };
  firebase.initializeApp(config);


    // Create a variable to reference the database.
    var database = firebase.database();
// 2. Button for adding Trains
$("#add-train").on("click", function(event) {
  event.preventDefault();
  var trainNumber = "#";
  // Grabs user input
  var trainName = $("#name-input").val().trim();
  console.log(trainName);
  var trainDestination = $("#destination-input").val().trim();
  console.log(trainDestination);
  var trainTime = moment($("#time-input").val().trim(),"hh:mm").format("HH:mm:ss A");
  console.log(trainTime);
  var trainFrequency = $("#frequency-input").val().trim();
  console.log(trainFrequency);

  // object for train data
  var newTrain = {
    number: trainNumber,
    name: trainName,
    destination: trainDestination,
    time: trainTime,
    frequency: trainFrequency
  };

  // Uploads employee data to the database
  database.ref().push(newTrain);

  // Logs everything to console
  console.log(newTrain.name);
  console.log(newTrain.destination);
  console.log(newTrain.time);
  console.log(newTrain.frequency);

  alert("Train successfully added");

  // Clears all of the text-boxes
  $("#name-input").val("");
  $("#destination-input").val("");
  $("#time-input").val("");
  $("#frequency-input").val("");
});

// 3. Create Firebase event for adding employee to the database and a row in the html when a user adds an entry
database.ref().on("child_added", function(childSnapshot) {
  console.log(childSnapshot.val());

  // Store everything into a variable.
  var trainName = childSnapshot.val().name;
  var trainDestination = childSnapshot.val().destination;
  var trainTime = childSnapshot.val().time;
  var trainFrequency = childSnapshot.val().frequency;

  // Employee Info
  console.log(trainName);
  console.log(trainDestination);
  console.log(trainTime);
  console.log(trainFrequency);

  // Prettify the employee start
  var tFrequency = trainFrequency
  var firstTime = trainTime
  
  var firstTimeConverted = moment(firstTime, "HH:mm").subtract(1, "years");
    console.log(firstTimeConverted);
// Current Time
var currentTime = moment();
    console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));

    // Difference between the times
    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
    console.log("DIFFERENCE IN TIME: " + diffTime);

    // Time apart (remainder)
    var tRemainder = diffTime % tFrequency;
    console.log(tRemainder);

    // Minute Until Train
    var tMinutesTillTrain = tFrequency - tRemainder;
    console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);

    // Next Train
    var nextTrain = moment().add(tMinutesTillTrain, "minutes");
    console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"));

  // Create the new row
  var newRow = $("<tr>").append(
    $("<td>").text("#"),
    $("<td>").text(trainName),
    $("<td>").text(trainDestination),
    $("<td>").text(trainFrequency),
    $("<td>").text(nextTrain),
    $("<td>").text(tMinutesTillTrain)
  );

  // Append the new row to the table
  $("#train-table > tbody").append(newRow);
});

// Example Time Math
// -----------------------------------------------------------------------------
// Assume Employee start date of January 1, 2015
// Assume current date is March 1, 2016

// We know that this is 15 months.
// Now we will create code in moment.js to confirm that any attempt we use meets this test case
  </script>

</body>

</html>